<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Личный кабинет - БНТП</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.3/main.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.3/main.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.3/locales/ru.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .stat-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .sidebar {
            transition: all 0.3s ease;
        }
        .sidebar-collapsed {
            width: 80px;
        }
        .notification-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .welcome-banner {
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQ0MCIgaGVpZ2h0PSIzMjAiIHZpZXdCb3g9IjAgMCAxNDQwIDMyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAgMTYwTDQ4IDEzOC43QzQzOC43IDExNy4zIDIyMi43IDc0LjcgMzIwIDc0LjdDNDE3LjMgNzQuNyA0MDAuMyAxMTcuMyA0ODAgMTM4LjdDNTU5LjcgMTYwIDYzOS4zIDEzOC43IDcyMCAxMTcuM0M4MDAuNyA5NiA4ODAuNyA3NC43IDk2MCA5NkMxMDM5LjMgMTE3LjMgMTExOS4zIDE4MS4zIDEyMDAgMjAyLjdDMTI4MC43IDIyNCAxMzYwLjcgMjAyLjcgMTQ0MCAxODEuM0wxNDQwIDMyMEwxMzkyIDMyMEMxMzQ0IDMyMCAxMjk2IDMyMCAxMjQ4IDMyMEMxMjAwIDMyMCAxMTUyIDMyMCAxMTA0IDMyMEMxMDU2IDMyMCAxMDA4IDMyMCA5NjAgMzIwQzkxMiAzMjAgODY0IDMyMCA4MTYgMzIwQzc2OCAzMjAgNzIwIDMyMCA2NzIgMzIwQzYyNCAzMjAgNTc2IDMyMCA1MjggMzIwQzQ4MCAzMjAgNDMyIDMyMCAzODQgMzIwQzMzNiAzMjAgMjg4IDMyMCAyNDAgMzIwQzE5MiAzMjAgMTQ0IDMyMCA5NiAzMjBDNDggMzIwIDI0IDMyMCAwIDMyMEwwIDE2MFoiIGZpbGw9InVybCgjcGFpbnQwX2xpbmVhcl8xXzIpIi8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXJfMV8yIiB4MT0iMCIgeTE9IjE2MCIgeDI9IjE0NDAiIHkyPSIxNjAiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N0VFQSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3NjRCQTIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4=') no-repeat bottom;
            background-size: cover;
        }
        .equipment-item {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            margin: 4px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .equipment-item:hover {
            border-color: #8b5cf6;
            background-color: #f3f4f6;
        }
        .equipment-item.selected {
            border-color: #8b5cf6;
            background-color: #ede9fe;
        }
        .calendar-container {
            min-height: 500px;
        }
        .fc-event {
            cursor: pointer;
        }
        .conflict-booking {
            background-color: #fecaca !important;
            border-color: #dc2626 !important;
        }
        .pending-booking {
            background-color: #fef3c7 !important;
            border-color: #d97706 !important;
        }
        .approved-booking {
            background-color: #d1fae5 !important;
            border-color: #10b981 !important;
        }
        .my-booking {
            background-color: #ddd6fe !important;
            border-color: #8b5cf6 !important;
        }
    </style>
</head>
<body class="bg-gray-50">

<!-- Sidebar -->
<div id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-white shadow-lg z-30 sidebar">
    <div class="p-6">
        <div class="flex items-center space-x-3 mb-8">
            <div class="w-10 h-10 gradient-bg rounded-lg flex items-center justify-center text-white">
                <i class="fas fa-cube"></i>
            </div>
            <h1 class="text-xl font-bold gradient-text">БНТП</h1>
        </div>

        <nav class="space-y-2">
            <button onclick="switchTab('overview')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-purple-50 text-gray-700 flex items-center space-x-3 transition bg-purple-100 text-purple-700">
                <i class="fas fa-home w-5"></i>
                <span class="sidebar-text">Обзор</span>
            </button>
            <button onclick="switchTab('bookings')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-purple-50 text-gray-700 flex items-center space-x-3 transition">
                <i class="fas fa-calendar-check w-5"></i>
                <span class="sidebar-text">Мои бронирования</span>
            </button>
            <button onclick="switchTab('announcements')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-purple-50 text-gray-700 flex items-center space-x-3 transition">
                <i class="fas fa-bullhorn w-5"></i>
                <span class="sidebar-text">Объявления</span>
            </button>
            <button onclick="switchTab('profile')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-purple-50 text-gray-700 flex items-center space-x-3 transition">
                <i class="fas fa-user w-5"></i>
                <span class="sidebar-text">Профиль</span>
            </button>
        </nav>
    </div>

    <div class="absolute bottom-0 left-0 right-0 p-6">
        <button onclick="toggleSidebar()" class="w-full text-center text-gray-500 hover:text-gray-700">
            <i class="fas fa-chevron-left" id="sidebarToggleIcon"></i>
        </button>
    </div>
</div>

<!-- Main Content -->
<div class="ml-64 transition-all" id="mainContent">
    <!-- Header -->
    <nav class="bg-white shadow-sm p-4 sticky top-0 z-20">
        <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold text-gray-800" id="pageTitle">Личный кабинет</h2>
            <div class="flex items-center space-x-4">
                <!-- Notifications -->
                <div class="relative">
                    <button onclick="toggleNotifications()" class="text-gray-600 hover:text-gray-800 relative">
                        <i class="fas fa-bell text-xl"></i>
                        <span id="notificationBadge" class="notification-badge absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden">0</span>
                    </button>

                    <!-- Notifications dropdown -->
                    <div id="notificationsDropdown" class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border hidden z-50">
                        <div class="p-4 border-b">
                            <h3 class="font-semibold text-gray-800">Уведомления</h3>
                        </div>
                        <div id="notificationsList" class="max-h-64 overflow-y-auto">
                            <!-- Notifications will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- User Menu -->
                <div class="flex items-center space-x-3">
                    <img src="https://ui-avatars.com/api/?name=Resident&background=667eea&color=fff" alt="Avatar" class="w-10 h-10 rounded-full">
                    <div>
                        <p class="text-sm font-medium text-gray-700" id="userName">Резидент</p>
                        <p class="text-xs text-gray-500" id="userRole">Резидент</p>
                    </div>
                    <button onclick="logout()" class="ml-3 text-red-500 hover:text-red-600">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="p-6">
        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <!-- Welcome Banner -->
            <div class="welcome-banner gradient-bg rounded-2xl p-8 mb-8 text-white">
                <h1 class="text-3xl font-bold mb-2">Добро пожаловать в ваш личный кабинет!</h1>
                <p class="text-lg opacity-90">Управляйте бронированиями и следите за новостями технопарка</p>
                <div class="mt-6 flex space-x-4">
                    <button onclick="openResidentBookingModal()" class="bg-white text-purple-600 px-6 py-2 rounded-lg font-medium hover:bg-gray-100 transition">
                        <i class="fas fa-plus mr-2"></i>Новое бронирование
                    </button>
                    <button onclick="switchTab('announcements')" class="bg-purple-700 text-white px-6 py-2 rounded-lg font-medium hover:bg-purple-800 transition">
                        <i class="fas fa-bullhorn mr-2"></i>Объявления
                    </button>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card p-6 rounded-xl">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <p class="text-sm text-gray-600">Мои бронирования</p>
                            <p class="text-3xl font-bold text-gray-800" id="myBookingsCount">5</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-calendar-check text-purple-600"></i>
                        </div>
                    </div>
                    <div class="flex items-center text-sm">
                        <i class="fas fa-arrow-up text-green-500 mr-1"></i>
                        <span class="text-green-500">2</span>
                        <span class="text-gray-500 ml-1">в этом месяце</span>
                    </div>
                </div>

                <div class="stat-card p-6 rounded-xl">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <p class="text-sm text-gray-600">Активные брони</p>
                            <p class="text-3xl font-bold text-gray-800" id="activeBookingsCount">3</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clock text-blue-600"></i>
                        </div>
                    </div>
                    <div class="flex items-center text-sm">
                        <i class="fas fa-calendar-day text-blue-500 mr-1"></i>
                        <span class="text-blue-500">Предстоящие</span>
                    </div>
                </div>

                <div class="stat-card p-6 rounded-xl">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <p class="text-sm text-gray-600">Новые объявления</p>
                            <p class="text-3xl font-bold text-gray-800" id="newAnnouncementsCount">2</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-bullhorn text-green-600"></i>
                        </div>
                    </div>
                    <div class="flex items-center text-sm">
                        <i class="fas fa-clock text-gray-500 mr-1"></i>
                        <span class="text-gray-500">За неделю</span>
                    </div>
                </div>

                <div class="stat-card p-6 rounded-xl">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <p class="text-sm text-gray-600">Любимое помещение</p>
                            <p class="text-2xl font-bold text-gray-800">Переговорка</p>
                        </div>
                        <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-star text-orange-600"></i>
                        </div>
                    </div>
                    <div class="flex items-center text-sm">
                        <i class="fas fa-chart-line text-orange-500 mr-1"></i>
                        <span class="text-orange-500">60% бронирований</span>
                    </div>
                </div>
            </div>

            <!-- Recent Bookings and Announcements -->
            <div class="grid lg:grid-cols-2 gap-6">
                <!-- Recent Bookings -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Последние бронирования</h3>
                        <button onclick="switchTab('bookings')" class="text-purple-600 hover:text-purple-700 text-sm">
                            Все <i class="fas fa-arrow-right ml-1"></i>
                        </button>
                    </div>
                    <div class="space-y-4" id="recentBookings">
                        <!-- Recent bookings will be loaded here -->
                    </div>
                </div>

                <!-- Recent Announcements -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Новые объявления</h3>
                        <button onclick="switchTab('announcements')" class="text-purple-600 hover:text-purple-700 text-sm">
                            Все <i class="fas fa-arrow-right ml-1"></i>
                        </button>
                    </div>
                    <div class="space-y-4" id="recentAnnouncements">
                        <!-- Recent announcements will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Bookings Tab -->
        <div id="bookings" class="tab-content">
            <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Календарь бронирования</h2>
                    <div class="flex space-x-4">
                        <select id="roomTypeSelect" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="">Выберите тип помещения</option>
                        </select>
                        <button onclick="openResidentBookingModal()" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90 transition">
                            <i class="fas fa-plus mr-2"></i>Новая бронь
                        </button>
                    </div>
                </div>

                <div class="calendar-container">
                    <div id="calendar"></div>
                </div>

                <div class="mt-4 flex space-x-4 text-sm">
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-green-200 border border-green-500 rounded mr-2"></div>
                        <span>Подтверждено</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-yellow-200 border border-yellow-500 rounded mr-2"></div>
                        <span>Ожидает подтверждения</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-red-200 border border-red-500 rounded mr-2"></div>
                        <span>Конфликт</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-purple-200 border border-purple-500 rounded mr-2"></div>
                        <span>Мои бронирования</span>
                    </div>
                </div>
            </div>

            <!-- My Bookings List -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h3 class="text-xl font-semibold mb-4">Мои бронирования</h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                        <tr class="text-left border-b">
                            <th class="pb-3 font-medium text-gray-700">Помещение</th>
                            <th class="pb-3 font-medium text-gray-700">Дата и время</th>
                            <th class="pb-3 font-medium text-gray-700">Цель</th>
                            <th class="pb-3 font-medium text-gray-700">Статус</th>
                            <th class="pb-3 font-medium text-gray-700">Действия</th>
                        </tr>
                        </thead>
                        <tbody id="myBookingsList">
                        <!-- My bookings will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Announcements Tab -->
        <div id="announcements" class="tab-content">
            <div class="bg-white rounded-xl shadow-sm p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Объявления</h2>
                    <div class="flex space-x-4">
                        <select class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option>Все типы</option>
                            <option>Новости</option>
                            <option>Вакансии</option>
                            <option>События</option>
                        </select>
                        <button onclick="openAnnouncementModal()" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90 transition">
                            <i class="fas fa-plus mr-2"></i>Создать объявление
                        </button>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="announcementsList">
                    <!-- Announcements will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Profile Tab -->
        <div id="profile" class="tab-content">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <h2 class="text-2xl font-bold mb-6">Профиль резидента</h2>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">Информация о компании</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Название компании</label>
                                    <p class="text-gray-900" id="companyName">ИТ Компания</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                    <p class="text-gray-900" id="companyEmail">resident@example.com</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Телефон</label>
                                    <p class="text-gray-900" id="companyPhone">+375 (29) 123-45-67</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Дата регистрации</label>
                                    <p class="text-gray-900" id="registrationDate">15.08.2024</p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-lg font-semibold mb-4">Статистика</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Всего бронирований:</span>
                                    <span class="font-semibold">23</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Активных бронирований:</span>
                                    <span class="font-semibold">3</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Создано объявлений:</span>
                                    <span class="font-semibold">8</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Время в технопарке:</span>
                                    <span class="font-semibold">4 месяца</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Быстрые действия</h3>
                        <div class="space-y-3">
                            <button onclick="openResidentBookingModal()" class="w-full text-left p-3 rounded-lg hover:bg-gray-50 transition flex items-center">
                                <i class="fas fa-calendar-plus text-purple-600 mr-3"></i>
                                <span>Создать новое бронирование</span>
                            </button>
                            <button onclick="openAnnouncementModal()" class="w-full text-left p-3 rounded-lg hover:bg-gray-50 transition flex items-center">
                                <i class="fas fa-bullhorn text-blue-600 mr-3"></i>
                                <span>Создать объявление</span>
                            </button>
                            <button onclick="switchTab('bookings')" class="w-full text-left p-3 rounded-lg hover:bg-gray-50 transition flex items-center">
                                <i class="fas fa-list text-green-600 mr-3"></i>
                                <span>Просмотреть мои бронирования</span>
                            </button>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Поддержка</h3>
                        <div class="space-y-3">
                            <div class="flex items-center">
                                <i class="fas fa-phone text-purple-600 mr-3"></i>
                                <div>
                                    <p class="font-medium">Телефон поддержки</p>
                                    <p class="text-sm text-gray-600">+375 (162) 20-15-60</p>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-envelope text-blue-600 mr-3"></i>
                                <div>
                                    <p class="font-medium">Email поддержки</p>
                                    <p class="text-sm text-gray-600">support@bntp.by</p>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-clock text-green-600 mr-3"></i>
                                <div>
                                    <p class="font-medium">Часы работы</p>
                                    <p class="text-sm text-gray-600">Пн-Пт: 9:00 - 18:00</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Resident Booking Modal -->
<div id="residentBookingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white p-8 rounded-xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold">Новая бронь</h3>
            <button onclick="closeResidentBookingModal()" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <form id="residentBookingForm" class="space-y-6">
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium mb-2">Тип помещения</label>
                    <select name="roomTypeName" required class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <option value="">Выберите тип</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Цель мероприятия</label>
                    <input type="text" name="purpose" required placeholder="Например: Совещание отдела"
                           class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium mb-2">Начало</label>
                    <input type="datetime-local" name="startTime" required
                           class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Окончание</label>
                    <input type="datetime-local" name="endTime" required
                           class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium mb-2">Дополнительное оборудование</label>
                <div class="grid md:grid-cols-2 gap-2" id="equipmentOptions">
                    <!-- Equipment options will be loaded here -->
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeResidentBookingModal()"
                        class="px-6 py-3 text-gray-600 hover:bg-gray-100 rounded-lg transition">
                    Отмена
                </button>
                <button type="submit"
                        class="px-6 py-3 gradient-bg text-white rounded-lg hover:opacity-90 transition">
                    <i class="fas fa-save mr-2"></i>Создать бронь
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Announcement Modal -->
<div id="announcementModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white p-8 rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold">Новое объявление</h3>
            <button onclick="closeAnnouncementModal()" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <form id="announcementForm" class="space-y-6">
            <div>
                <label class="block text-sm font-medium mb-2">Заголовок</label>
                <input type="text" name="title" required placeholder="Введите заголовок объявления"
                       class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>

            <div>
                <label class="block text-sm font-medium mb-2">Тип объявления</label>
                <div class="grid grid-cols-3 gap-3">
                    <label class="relative">
                        <input type="radio" name="type" value="NEWS" required class="sr-only peer">
                        <div class="p-4 border rounded-lg cursor-pointer hover:bg-gray-50 peer-checked:border-purple-500 peer-checked:bg-purple-50">
                            <i class="fas fa-newspaper text-2xl text-blue-600 mb-2"></i>
                            <p class="font-medium">Новости</p>
                        </div>
                    </label>
                    <label class="relative">
                        <input type="radio" name="type" value="VACANCY" required class="sr-only peer">
                        <div class="p-4 border rounded-lg cursor-pointer hover:bg-gray-50 peer-checked:border-purple-500 peer-checked:bg-purple-50">
                            <i class="fas fa-briefcase text-2xl text-green-600 mb-2"></i>
                            <p class="font-medium">Вакансия</p>
                        </div>
                    </label>
                    <label class="relative">
                        <input type="radio" name="type" value="EVENT" required class="sr-only peer">
                        <div class="p-4 border rounded-lg cursor-pointer hover:bg-gray-50 peer-checked:border-purple-500 peer-checked:bg-purple-50">
                            <i class="fas fa-calendar-alt text-2xl text-orange-600 mb-2"></i>
                            <p class="font-medium">Мероприятие</p>
                        </div>
                    </label>
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium mb-2">Содержание</label>
                <textarea name="content" required rows="6" placeholder="Введите текст объявления"
                          class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"></textarea>
            </div>

            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <div class="flex items-start">
                    <i class="fas fa-info-circle text-yellow-600 mt-1 mr-2"></i>
                    <div class="text-sm text-yellow-800">
                        <p class="font-medium">Обратите внимание</p>
                        <p>Ваше объявление будет отправлено на модерацию и опубликовано после одобрения администратором.</p>
                    </div>
                </div>
            </div>

            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeAnnouncementModal()"
                        class="px-6 py-3 text-gray-600 hover:bg-gray-100 rounded-lg transition">
                    Отмена
                </button>
                <button type="submit"
                        class="px-6 py-3 gradient-bg text-white rounded-lg hover:opacity-90 transition">
                    <i class="fas fa-paper-plane mr-2"></i>Отправить на модерацию
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Global variables
    let currentTab = 'overview';
    let calendar;
    let roomTypes = [];
    let equipmentTypes = [];

    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function() {
        loadRoomTypes();
        loadEquipmentTypes();
        loadNotifications();
        loadDashboardData();
        switchTab('overview');
    });

    function loadRoomTypes() {
        fetch('/api/room-types')
            .then(response => response.json())
            .then(data => {
                roomTypes = data;
                populateRoomTypeSelects();
            })
            .catch(error => console.error('Error loading room types:', error));
    }

    function populateRoomTypeSelects() {
        const selects = [
            document.getElementById('roomTypeSelect'),
            document.querySelector('#residentBookingForm select[name="roomTypeName"]')
        ];

        selects.forEach(select => {
            if (select) {
                select.innerHTML = '<option value="">Выберите тип помещения</option>';
                roomTypes.forEach(roomType => {
                    const option = document.createElement('option');
                    option.value = roomType.name;
                    option.textContent = `${roomType.name} (${roomType.area}м², до ${roomType.capacity} мест, ${roomType.hourlyRate}₽/час)`;
                    select.appendChild(option);
                });
            }
        });

        // Add event listener for room type selection
        const roomTypeSelect = document.getElementById('roomTypeSelect');
        if (roomTypeSelect) {
            roomTypeSelect.addEventListener('change', function() {
                if (calendar) {
                    calendar.refetchEvents();
                }
            });
        }
    }

    function loadEquipmentTypes() {
        fetch('/api/equipment-types')
            .then(response => response.json())
            .then(data => {
                equipmentTypes = data;
                populateEquipmentOptions();
            })
            .catch(error => {
                console.error('Error loading equipment types:', error);
                // Fallback equipment data
                equipmentTypes = [
                    { name: 'INTERACTIVE_SCREEN', displayName: 'Интерактивный экран', dailyRate: 50.0 },
                    { name: 'PROJECTOR', displayName: 'Проектор', dailyRate: 30.0 },
                    { name: 'AUDIO_SYSTEM', displayName: 'Акустическая система/микрофоны', dailyRate: 40.0 },
                    { name: 'CONFERENCE_CAMERA', displayName: 'Конференц-камера (Zoom)', dailyRate: 60.0 },
                    { name: 'FLIPCHART', displayName: 'Флипчарт + маркеры', dailyRate: 15.0 },
                    { name: 'THERMOPOT_4L', displayName: 'Термопот (4л)', dailyRate: 20.0 },
                    { name: 'THERMOPOT_10L', displayName: 'Термопот (10л)', dailyRate: 35.0 },
                    { name: 'VIDEO_CAMERA', displayName: 'Видеокамера Sony PXW-Z150', dailyRate: 100.0 }
                ];
                populateEquipmentOptions();
            });
    }

    function populateEquipmentOptions() {
        const container = document.getElementById('equipmentOptions');
        if (container) {
            container.innerHTML = '';
            equipmentTypes.forEach(equipment => {
                const div = document.createElement('div');
                div.className = 'equipment-item';
                div.innerHTML = `
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" name="selectedEquipment" value="${equipment.name || equipment}" class="mr-2">
                        <div>
                            <span class="font-medium">${equipment.displayName || equipment}</span>
                            <div class="text-sm text-gray-500">${equipment.dailyRate || 0}₽/день</div>
                        </div>
                    </label>
                `;
                container.appendChild(div);

                // Add click handler for visual selection
                div.addEventListener('click', function(e) {
                    if (e.target.type !== 'checkbox') {
                        const checkbox = div.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked;
                    }

                    if (div.querySelector('input[type="checkbox"]').checked) {
                        div.classList.add('selected');
                    } else {
                        div.classList.remove('selected');
                    }
                });
            });
        }
    }

    function switchTab(tabId) {
        // Update page title
        const titles = {
            'overview': 'Личный кабинет',
            'bookings': 'Мои бронирования',
            'announcements': 'Объявления',
            'profile': 'Профиль'
        };
        document.getElementById('pageTitle').textContent = titles[tabId] || 'Личный кабинет';

        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });

        // Show selected tab
        document.getElementById(tabId).classList.add('active');

        // Update sidebar active state
        document.querySelectorAll('nav button').forEach(btn => {
            btn.classList.remove('bg-purple-100', 'text-purple-700');
            btn.classList.add('text-gray-700');
        });
        event.currentTarget.classList.add('bg-purple-100', 'text-purple-700');
        event.currentTarget.classList.remove('text-gray-700');

        currentTab = tabId;

        // Load tab data
        loadTabData(tabId);
    }

    function loadTabData(tabId) {
        switch(tabId) {
            case 'bookings':
                initializeCalendar();
                loadMyBookings();
                break;
            case 'announcements':
                loadAnnouncements();
                break;
        }
    }

    function initializeCalendar() {
        const calendarEl = document.getElementById('calendar');
        if (!calendarEl) return;

        calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'timeGridWeek',
            locale: 'ru',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            slotMinTime: '08:00:00',
            slotMaxTime: '20:00:00',
            businessHours: {
                daysOfWeek: [1, 2, 3, 4, 5],
                startTime: '09:00',
                endTime: '18:00'
            },
            events: function(info, successCallback, failureCallback) {
                loadCalendarEvents(info.start, info.end, successCallback);
            },
            eventClick: function(info) {
                showBookingDetails(info.event);
            },
            selectable: true,
            selectMirror: true,
            select: function(arg) {
                openResidentBookingModal(arg.start, arg.end);
            }
        });
        calendar.render();
    }

    function loadCalendarEvents(start, end, callback) {
        const roomTypeSelect = document.getElementById('roomTypeSelect');
        const selectedRoomType = roomTypeSelect ? roomTypeSelect.value : '';

        if (!selectedRoomType) {
            callback([]);
            return;
        }

        const startStr = start.toISOString();
        const endStr = end.toISOString();

        fetch(`/api/room-bookings/${selectedRoomType}?start=${startStr}&end=${endStr}`)
            .then(response => response.json())
            .then(data => {
                const events = data.map(booking => ({
                    id: booking.id,
                    title: booking.purpose || 'Бронирование',
                    start: booking.startTime,
                    end: booking.endTime,
                    className: getBookingClassName(booking),
                    extendedProps: {
                        booking: booking
                    }
                }));
                callback(events);
            })
            .catch(error => {
                console.error('Error loading calendar events:', error);
                callback([]);
            });
    }

    function getBookingClassName(booking) {
        // Check if this is user's booking (you would need to compare with current user)
        const isMyBooking = booking.user && booking.user.username === 'resident1'; // This should be dynamic

        if (isMyBooking) {
            return 'my-booking';
        }

        switch (booking.status) {
            case 'APPROVED': return 'approved-booking';
            case 'PENDING': return 'pending-booking';
            case 'CONFLICT': return 'conflict-booking';
            default: return '';
        }
    }

    function loadMyBookings() {
        const tbody = document.getElementById('myBookingsList');
        if (tbody) {
            tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4">Загрузка...</td></tr>';

            // Simulate loading my bookings
            setTimeout(() => {
                tbody.innerHTML = `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="py-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-users text-purple-600"></i>
                                </div>
                                <div>
                                    <p class="font-medium">Переговорка</p>
                                    <p class="text-sm text-gray-500">55 м², до 15 мест</p>
                                </div>
                            </div>
                        </td>
                        <td class="py-4">
                            <p class="font-medium">20.12.2024</p>
                            <p class="text-sm text-gray-500">14:00 - 16:00</p>
                        </td>
                        <td class="py-4">
                            <p class="text-sm">Совещание отдела разработки</p>
                        </td>
                        <td class="py-4">
                            <span class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-800">Подтверждено</span>
                        </td>
                        <td class="py-4">
                            <div class="flex space-x-2">
                                <button class="text-blue-600 hover:bg-blue-50 p-2 rounded">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="text-gray-600 hover:bg-gray-100 p-2 rounded">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }, 500);
        }
    }

    function loadAnnouncements() {
        fetch('/api/announcements')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('announcementsList');
                container.innerHTML = '';

                data.forEach(announcement => {
                    const div = document.createElement('div');
                    div.className = 'border rounded-xl p-6 hover:shadow-lg transition';

                    const typeColors = {
                        'NEWS': 'blue',
                        'VACANCY': 'green',
                        'EVENT': 'orange'
                    };
                    const color = typeColors[announcement.type] || 'gray';

                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <span class="px-3 py-1 text-xs rounded-full bg-${color}-100 text-${color}-800">
                                ${announcement.type === 'NEWS' ? 'Новости' :
                        announcement.type === 'VACANCY' ? 'Вакансия' : 'Мероприятие'}
                            </span>
                            <span class="text-xs text-gray-500">${new Date(announcement.createdAt).toLocaleDateString('ru-RU')}</span>
                        </div>
                        <h3 class="font-semibold text-lg mb-2">${announcement.title}</h3>
                        <p class="text-gray-600 text-sm mb-4">${announcement.content.substring(0, 150)}...</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-500">Автор: ${announcement.author ? announcement.author.company : 'БНТП'}</span>
                            <button class="text-purple-600 hover:text-purple-700 text-sm font-medium">
                                Читать далее →
                            </button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            })
            .catch(error => console.error('Error loading announcements:', error));
    }

    function loadDashboardData() {
        // Load recent bookings
        const recentBookings = document.getElementById('recentBookings');
        recentBookings.innerHTML = `
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-check text-green-600 text-xs"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium">Переговорка</p>
                        <p class="text-xs text-gray-500">20.12.2024, 14:00-16:00</p>
                    </div>
                </div>
                <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Подтверждено</span>
            </div>
        `;

        // Load recent announcements
        const recentAnnouncements = document.getElementById('recentAnnouncements');
        recentAnnouncements.innerHTML = `
            <div class="p-3 bg-gray-50 rounded-lg">
                <div class="flex items-start justify-between mb-2">
                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Новости</span>
                    <span class="text-xs text-gray-500">2 дня назад</span>
                </div>
                <h4 class="text-sm font-medium mb-1">Новое оборудование в технопарке</h4>
                <p class="text-xs text-gray-600">Установлено современное конференц-оборудование...</p>
            </div>
        `;
    }

    function loadNotifications() {
        fetch('/api/notifications')
            .then(response => response.json())
            .then(data => {
                const unreadCount = data.filter(n => !n.read).length;
                const badge = document.getElementById('notificationBadge');
                const list = document.getElementById('notificationsList');

                if (unreadCount > 0) {
                    badge.textContent = unreadCount;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }

                list.innerHTML = '';
                if (data.length === 0) {
                    list.innerHTML = '<div class="p-4 text-gray-500 text-center">Нет уведомлений</div>';
                } else {
                    data.slice(0, 5).forEach(notification => {
                        const div = document.createElement('div');
                        div.className = `p-3 border-b ${notification.read ? 'bg-gray-50' : 'bg-blue-50'}`;
                        div.innerHTML = `
                            <div class="font-medium text-sm">${notification.title}</div>
                            <div class="text-xs text-gray-600 mt-1">${notification.message}</div>
                            <div class="text-xs text-gray-400 mt-1">${new Date(notification.createdAt).toLocaleString('ru-RU')}</div>
                        `;

                        if (!notification.read) {
                            div.addEventListener('click', () => markNotificationAsRead(notification.id));
                        }

                        list.appendChild(div);
                    });
                }
            })
            .catch(error => console.error('Error loading notifications:', error));
    }

    function markNotificationAsRead(notificationId) {
        fetch(`/api/notifications/${notificationId}/read`, { method: 'POST' })
            .then(() => loadNotifications())
            .catch(error => console.error('Error marking notification as read:', error));
    }

    function toggleNotifications() {
        const dropdown = document.getElementById('notificationsDropdown');
        dropdown.classList.toggle('hidden');
    }

    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const icon = document.getElementById('sidebarToggleIcon');

        sidebar.classList.toggle('sidebar-collapsed');

        if (sidebar.classList.contains('sidebar-collapsed')) {
            mainContent.style.marginLeft = '80px';
            icon.className = 'fas fa-chevron-right';
            document.querySelectorAll('.sidebar-text').forEach(el => el.style.display = 'none');
        } else {
            mainContent.style.marginLeft = '256px';
            icon.className = 'fas fa-chevron-left';
            setTimeout(() => {
                document.querySelectorAll('.sidebar-text').forEach(el => el.style.display = 'block');
            }, 150);
        }
    }

    // Modal functions
    function openResidentBookingModal(start = null, end = null) {
        document.getElementById('residentBookingModal').classList.remove('hidden');

        if (start && end) {
            const startInput = document.querySelector('#residentBookingForm input[name="startTime"]');
            const endInput = document.querySelector('#residentBookingForm input[name="endTime"]');

            if (startInput && endInput) {
                startInput.value = start.toISOString().slice(0, 16);
                endInput.value = end.toISOString().slice(0, 16);
            }
        }
    }

    function closeResidentBookingModal() {
        document.getElementById('residentBookingModal').classList.add('hidden');
        document.getElementById('residentBookingForm').reset();
        // Clear equipment selections
        document.querySelectorAll('.equipment-item').forEach(item => {
            item.classList.remove('selected');
            item.querySelector('input[type="checkbox"]').checked = false;
        });
    }

    function openAnnouncementModal() {
        document.getElementById('announcementModal').classList.remove('hidden');
    }

    function closeAnnouncementModal() {
        document.getElementById('announcementModal').classList.add('hidden');
        document.getElementById('announcementForm').reset();
    }

    // Form handlers
    document.getElementById('residentBookingForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());

        // Collect selected equipment
        const selectedEquipment = [];
        document.querySelectorAll('input[name="selectedEquipment"]:checked').forEach(checkbox => {
            selectedEquipment.push(checkbox.value);
        });

        const bookingData = {
            roomTypeName: data.roomTypeName,
            startTime: data.startTime,
            endTime: data.endTime,
            purpose: data.purpose,
            selectedEquipment: selectedEquipment
        };

        fetch('/api/booking', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(bookingData)
        })
            .then(response => response.json())
            .then(result => {
                closeResidentBookingModal();
                if (calendar) {
                    calendar.refetchEvents();
                }
                loadMyBookings();
                showNotification('Бронь создана успешно!', 'success');
            })
            .catch(error => {
                showNotification('Ошибка создания брони: ' + error.message, 'error');
            });
    });

    document.getElementById('announcementForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());

        fetch('/api/announcement', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
            .then(response => response.json())
            .then(result => {
                closeAnnouncementModal();
                loadAnnouncements();
                showNotification('Объявление отправлено на модерацию!', 'success');
            })
            .catch(error => {
                showNotification('Ошибка создания объявления: ' + error.message, 'error');
            });
    });

    // Notification function
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 p-4 rounded-lg text-white ${
            type === 'success' ? 'bg-green-500' :
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
        } shadow-lg z-50 animate-pulse`;
        notification.innerHTML = `
            <div class="flex items-center">
                <i class="fas ${
            type === 'success' ? 'fa-check-circle' :
                type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'
        } mr-2"></i>
                ${message}
            </div>
        `;
        document.body.appendChild(notification);

        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    function showBookingDetails(event) {
        const booking = event.extendedProps.booking;
        alert(`Бронирование: ${booking.purpose}\nВремя: ${event.start.toLocaleString()} - ${event.end.toLocaleString()}\nСтатус: ${booking.status}`);
    }

    function logout() {
        window.location.href = '/logout';
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
        const notificationsDropdown = document.getElementById('notificationsDropdown');
        const notificationButton = e.target.closest('[onclick="toggleNotifications()"]');

        if (!notificationButton && !notificationsDropdown.contains(e.target)) {
            notificationsDropdown.classList.add('hidden');
        }
    });

    // Close modals on ESC
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeResidentBookingModal();
            closeAnnouncementModal();
        }
    });

    // Set minimum date to today for booking form
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date().toISOString().slice(0, 16);
        const startTimeInput = document.querySelector('#residentBookingForm input[name="startTime"]');
        const endTimeInput = document.querySelector('#residentBookingForm input[name="endTime"]');

        if (startTimeInput) startTimeInput.min = today;
        if (endTimeInput) endTimeInput.min = today;
    });
</script>
</body>
</html>